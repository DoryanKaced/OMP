---

title: geoloader


keywords: fastai
sidebar: home_sidebar

summary: "This module gives the tool to load geospatial datas into a dataframe similar to the geopandas library dataframes. Geopandas will not be used as it is difficult to build and put into an executable form. Two types of files are supported : ESRI shapefiles and geojsons."
description: "This module gives the tool to load geospatial datas into a dataframe similar to the geopandas library dataframes. Geopandas will not be used as it is difficult to build and put into an executable form. Two types of files are supported : ESRI shapefiles and geojsons."
nb_path: "00_geoloader.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_geoloader.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-shapefiles">Load shapefiles<a class="anchor-link" href="#Load-shapefiles"> </a></h2><blockquote><p>There is a shapefile library (pyshp) that allows to load and parse shapefile</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shp_senegal</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;geospatial_data/Senegal&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)]</span>
<span class="n">shp_guyana</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;geospatial_data/Guyana&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)]</span>
<span class="n">shp_ecuador</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;geospatial_data/Ecuador&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_senegal</span><span class="p">:</span>
    <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="s2">&quot;./geospatial_data/Senegal/&quot;</span><span class="o">+</span><span class="n">shp</span><span class="p">)</span>

<span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_ecuador</span><span class="p">:</span>
    <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="s2">&quot;./geospatial_data/Ecuador/&quot;</span><span class="o">+</span><span class="n">shp</span><span class="p">)</span>

<span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_guyana</span><span class="p">:</span>
    <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="s2">&quot;./geospatial_data/Guyana/&quot;</span><span class="o">+</span><span class="n">shp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">UnicodeDecodeError</span>                        Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_20992/2282079860.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-intense-fg ansi-bold">      8</span> <span class="ansi-green-fg">for</span> shp <span class="ansi-green-fg">in</span> shp_ecuador<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg">     </span>shapefile<span class="ansi-blue-fg">.</span>Reader<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;./geospatial_data/Ecuador/&#34;</span><span class="ansi-blue-fg">+</span>shp<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span> 
<span class="ansi-green-intense-fg ansi-bold">     11</span> <span class="ansi-green-fg">for</span> shp <span class="ansi-green-fg">in</span> shp_guyana<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/lib/python3.8/site-packages/shapefile.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    806</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    807</span>             <span class="ansi-green-fg">if</span> is_string<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 808</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    809</span>                 <span class="ansi-green-fg">return</span>
<span class="ansi-green-intense-fg ansi-bold">    810</span>         <span class="ansi-red-fg"># Otherwise, load from separate shp/shx/dbf args (must be file-like)</span>

<span class="ansi-green-fg">~/.local/lib/python3.8/site-packages/shapefile.py</span> in <span class="ansi-cyan-fg">load</span><span class="ansi-blue-fg">(self, shapefile)</span>
<span class="ansi-green-intense-fg ansi-bold">    937</span>             self<span class="ansi-blue-fg">.</span>__shpHeader<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    938</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>dbf<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 939</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>__dbfHeader<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    940</span> 
<span class="ansi-green-intense-fg ansi-bold">    941</span>     <span class="ansi-green-fg">def</span> load_shp<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> shapefile_name<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/lib/python3.8/site-packages/shapefile.py</span> in <span class="ansi-cyan-fg">__dbfHeader</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1188</span>                 idx <span class="ansi-blue-fg">=</span> len<span class="ansi-blue-fg">(</span>fieldDesc<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">   1189</span>             fieldDesc<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> fieldDesc<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>idx<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">-&gt; 1190</span><span class="ansi-red-fg">             </span>fieldDesc<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> u<span class="ansi-blue-fg">(</span>fieldDesc<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>encoding<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>encodingErrors<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1191</span>             fieldDesc<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> fieldDesc<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>lstrip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1192</span>             fieldDesc<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> u<span class="ansi-blue-fg">(</span>fieldDesc<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;ascii&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.local/lib/python3.8/site-packages/shapefile.py</span> in <span class="ansi-cyan-fg">u</span><span class="ansi-blue-fg">(v, encoding, encodingErrors)</span>
<span class="ansi-green-intense-fg ansi-bold">    102</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>v<span class="ansi-blue-fg">,</span> bytes<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    103</span>             <span class="ansi-red-fg"># For python 3 decode bytes to str.</span>
<span class="ansi-green-fg">--&gt; 104</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> v<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>encoding<span class="ansi-blue-fg">,</span> encodingErrors<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    105</span>         <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>v<span class="ansi-blue-fg">,</span> str<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    106</span>             <span class="ansi-red-fg"># Already str.</span>

<span class="ansi-red-fg">UnicodeDecodeError</span>: &#39;utf-8&#39; codec can&#39;t decode byte 0xe9 in position 9: unexpected end of data</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Some attributes tables in the shapefiles can not be opened with the default encoding (utf-8), so there is a need to detect automatically the encoding of the .dbf file.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="detect_shp_encoding" class="doc_header"><code>detect_shp_encoding</code><a href="https://github.com/DoryanKaced/OMP/tree/main/OMP/geoloader.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>detect_shp_encoding</code>(<strong><code>path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_senegal</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./geospatial_data/Senegal/&quot;</span><span class="o">+</span><span class="n">shp</span>
        <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="n">detect_shp_encoding</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_ecuador</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./geospatial_data/Ecuador/&quot;</span><span class="o">+</span><span class="n">shp</span>
        <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="n">detect_shp_encoding</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_guyana</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./geospatial_data/Guyana/&quot;</span><span class="o">+</span><span class="n">shp</span>
        <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="n">detect_shp_encoding</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>The only failing load is on what seems to be a faulty shapefile. (The attribute table is empty)</p>
<p>The pyshp put the shapefile in this form :</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">geofile</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="n">detect_shp_encoding</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">geofile</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">geofile</span><span class="o">.</span><span class="n">shapes</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">geofile</span><span class="o">.</span><span class="n">records</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>shapefile Reader
    9 shapes (type &#39;POLYGON&#39;)
    9 records (6 fields)

Shapes: [&lt;shapefile.Shape object at 0x7f57f18e16a0&gt;, &lt;shapefile.Shape object at 0x7f57f0d284f0&gt;, &lt;shapefile.Shape object at 0x7f57f0d9bd90&gt;, &lt;shapefile.Shape object at 0x7f57f0d9b280&gt;, &lt;shapefile.Shape object at 0x7f57f0d9beb0&gt;, &lt;shapefile.Shape object at 0x7f57f0d9b100&gt;, &lt;shapefile.Shape object at 0x7f57f0d9b7f0&gt;, &lt;shapefile.Shape object at 0x7f57f0d9b490&gt;, &lt;shapefile.Shape object at 0x7f57f0d9b400&gt;]

[Record #0: [0, &#39;Zone brésilienne et de métissage&#39;, &#39;Habitations&#39;, &#39;Brésilien+Amérindien&#39;, &#39;Forêt+Habitations&#39;], Record #1: [0, &#39;Zone à relief -  Zone des teko&#39;, &#39;Habitations&#39;, &#39;Teko&#39;, &#39;Forêt+Habitations&#39;], Record #2: [0, &#39;Décharge brésilienne&#39;, &#39;Décharge&#39;, &#39;Brésilien&#39;, &#39;Berge&#39;], Record #3: [0, &#34;Zone pas peuplée, présence d&#39;abattis&#34;, &#39;Forêt+Abattis&#39;, &#39;Inhabité&#39;, &#39;Forêt+Abattis&#39;], Record #4: [0, &#39;Zone wayapi&#39;, &#39;Habitations&#39;, &#39;Wayapi&#39;, &#39;Forêt+Habitations&#39;], Record #5: [0, &#39;Baignade en été&#39;, &#39;Baignade&#39;, &#39;Inhabité&#39;, &#39;Berge&#39;], Record #6: [0, &#34;Pas d&#39;information&#34;, &#39;Forêt&#39;, &#39;NSP&#39;, &#39;Forêt&#39;], Record #7: [0, &#39;Baignade en été&#39;, &#39;Baignade&#39;, &#39;Inhabité&#39;, &#39;Berge&#39;], Record #8: [0, &#39;Fleuve Oyapock&#39;, &#39;Transit&#39;, &#39;Inhabité&#39;, &#39;Berge&#39;]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_file_shp" class="doc_header"><code>read_file_shp</code><a href="https://github.com/DoryanKaced/OMP/tree/main/OMP/geoloader.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_file_shp</code>(<strong><code>path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This function can load any ESRI shapefile given the path to it. The path must be the path to the .shp file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_senegal</span><span class="p">:</span>
    <span class="n">read_file_shp</span><span class="p">(</span><span class="s2">&quot;./geospatial_data/Senegal/&quot;</span><span class="o">+</span><span class="n">shp</span><span class="p">)</span>

<span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_ecuador</span><span class="p">:</span>
    <span class="n">read_file_shp</span><span class="p">(</span><span class="s2">&quot;./geospatial_data/Ecuador/&quot;</span><span class="o">+</span><span class="n">shp</span><span class="p">)</span>

<span class="k">for</span> <span class="n">shp</span> <span class="ow">in</span> <span class="n">shp_guyana</span><span class="p">:</span>
    <span class="n">read_file_shp</span><span class="p">(</span><span class="s2">&quot;./geospatial_data/Guyana/&quot;</span><span class="o">+</span><span class="n">shp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-geojsons">Load geojsons<a class="anchor-link" href="#Load-geojsons"> </a></h2>
</div>
</div>
</div>
</div>
 

